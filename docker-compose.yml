services:
  cyber-triage-cli:
    image: cyber-triage-cli:latest
    build:
      context: .
      dockerfile: Dockerfile

    container_name: cyber-triage-cli

    restart: unless-stopped

    environment:
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - CYBERHAVEN_API_KEY=${CYBERHAVEN_API_KEY}
      - CYBERHAVEN_API_URL=${CYBERHAVEN_API_URL:-https://payclip.cyberhaven.io/public}
      - AWS_DEFAULT_REGION=${AWS_DEFAULT_REGION:-us-west-2}
      - AWS_S3_BUCKET=${AWS_S3_BUCKET:-clip-cyberhaven-upload}
      - EVIDENCE_DIR=./evidencia_temp
      - INCIDENT_DAYS_BACK=${INCIDENT_DAYS_BACK:-3}
      - PYTHONUNBUFFERED=1

    volumes:
      - ./data:/home/cybertriage/app/data
      - ./evidencia_temp:/home/cybertriage/app/evidencia_temp
      - ./logs:/home/cybertriage/app/logs
      - ./prompts:/home/cybertriage/app/prompts:ro

    networks:
      - cyber-triage-net

    stdin_open: true
    tty: true

    healthcheck:
      test: ["CMD", "python3", "-c", "import sys; sys.exit(0)"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

networks:
  cyber-triage-net:
    driver: bridge
